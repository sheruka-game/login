<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>謝爾夏｜技能管理後台</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: 'Noto Sans TC', sans-serif; background: #f4f7fa; margin: 0; padding: 2rem; }
    h2 { text-align: center; }
    .container { max-width: 1000px; margin: auto; background: white; padding: 2rem; border-radius: 1rem; box-shadow: 0 2px 10px #0001; }
    select, input, textarea { width: 100%; padding: 0.6rem; margin-top: 0.5rem; margin-bottom: 1rem; border: 1px solid #ccc; border-radius: 0.5rem; }
    label { font-weight: bold; margin-top: 1rem; display: block; }
    button { padding: 0.6rem 1rem; background-color: #1d4076; color: white; border: none; border-radius: 0.5rem; cursor: pointer; }
    .success { color: #1767a0; font-weight: bold; }
    .error { color: #c34d4d; font-weight: bold; }
    .section { margin-top: 2rem; border-top: 1px solid #ddd; padding-top: 2rem; }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
  <div class="container">
    <h2>技能管理後台</h2>
    <label for="entry-type">選擇要輸入的資料類型</label>
    <select id="entry-type" onchange="toggleForm()">
      <option value="skill">技能效果 (skill_effects)</option>
      <option value="move">移動技能效果 (movement_skills)</option>
      <option value="debuff">技能副作用 (skill_debuff)</option>
    </select>

    <!-- 技能效果表單 -->
    <form id="form-skill" class="form-block">
      <label>技能名稱</label>
      <input type="text" id="effect_name">
      <label>技能描述</label>
      <textarea id="description"></textarea>
      <label>技能職業分類</label>
      <select id="effect_type">
        <option value="attack">攻擊用</option>
        <option value="attack_only">專攻限定</option>
        <option value="heal">補血用</option>
        <option value="heal_only">專補限定</option>
        <option value="tank">坦用</option>
        <option value="tank_only">專坦限定</option>
        <option value="buff">增益</option>
        <option value="buff_only">專增益限定</option>
        <option value="debuff">妨礙</option>
        <option value="debuff_only">專妨礙限定</option>
      </select>
      <label>技能作用對象</label>
      <select id="target_faction">
        <option value="enemy">敵方</option>
        <option value="ally">隊友</option>
        <option value="self">自己</option>
        <option value="team">隊友全體</option>
      </select>
      <label>最大影響人數</label>
      <input type="number" id="max_targets" min="1" max="3">
      <label>技能分數</label>
      <input type="number" id="score">
      <label>額外冷卻時間</label>
      <input type="number" id="extra_cd">
      <label>顯示代碼 (可留空)</label>
      <input type="text" id="effect_id_code">
      <label>技能程式邏輯碼 (可留空)</label>
      <input type="text" id="effect_code">
    </form>

    <!-- 移動技能效果表單 -->
    <form id="form-move" class="form-block" style="display:none">
      <label>移動技能名稱</label>
      <input type="text" id="move_name">
      <label>描述</label>
      <textarea id="move_description"></textarea>
      <label>技能作用對象</label>
      <select id="move_target_faction">
        <option value="enemy">敵方</option>
        <option value="ally">隊友</option>
        <option value="self">自己</option>
        <option value="team">隊友全體</option>
      </select>
      <label>施放區域</label>
      <select id="move_range">
        <option value="same_zone">同區</option>
        <option value="cross_zone">跨區</option>
        <option value="all_zone">全區</option>
      </select>
      <label>最大影響人數</label>
      <input type="number" id="move_max_targets" min="1" max="3" value="1">
      <label>技能分數</label>
      <input type="number" id="move_score">
      <label>額外冷卻時間</label>
      <input type="number" id="move_extra_cd">
      <label>顯示代碼 (可留空)</label>
      <input type="text" id="move_effect_id_code">
      <label>技能程式邏輯碼 (可留空)</label>
      <input type="text" id="move_effect_code">
    </form>

    <!-- 技能副作用表單 -->
    <form id="form-debuff" class="form-block" style="display:none">
      <label>副作用名稱</label>
      <input type="text" id="debuff_name">
      <label>副作用描述</label>
      <textarea id="debuff_description"></textarea>
      <label>副作用分類</label>
      <select id="debuff_type">
        <option value="cc">控場</option>
        <option value="cd">冷卻</option>
        <option value="pass">行動跳過</option>
        <option value="debuff">一般負面狀態</option>
        <option value="bleed">損血</option>
      </select>
      <label>抵銷用分數</label>
      <input type="number" id="debuff_offset_score">
      <label>額外冷卻時間</label>
      <input type="number" id="debuff_extra_cd">
      <label>套用對象</label>
      <select id="debuff_applied_to">
        <option value="self">自己</option>
        <option value="toally">技能施放對象</option>
      </select>
      <label>顯示代碼 (可留空)</label>
      <input type="text" id="debuff_effect_id_code">
      <label>副作用程式邏輯碼 (可留空)</label>
      <input type="text" id="debuff_effect_code">
    </form>

    <div id="msg" style="margin: 1em 0; min-height: 1.5em;"></div>
    <button onclick="handleSubmit()">送出資料</button>
  </div>

  <script>
    // ====== Supabase 設定 ======
    const client = window.supabase.createClient(
      'https://wfhwhvodgikpducrhgda.supabase.co',
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndmaHdodm9kZ2lrcGR1Y3JoZ2RhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDgwMTAwNjEsImV4cCI6MjA2MzU4NjA2MX0.P6P-x4SxjiR4VdWH6VFgY_ktgMac_OzuI4Bl7HWskz8'
    );

    function toggleForm() {
      const type = document.getElementById('entry-type').value;
      document.getElementById('form-skill').style.display = (type === 'skill') ? '' : 'none';
      document.getElementById('form-move').style.display = (type === 'move') ? '' : 'none';
      document.getElementById('form-debuff').style.display = (type === 'debuff') ? '' : 'none';
      document.getElementById('msg').innerHTML = '';
    }

    async function handleSubmit() {
      const type = document.getElementById('entry-type').value;
      let data = {};

      // 收集欄位
      if (type === 'skill') {
        data = {
          effect_name: document.getElementById('effect_name').value.trim(),
          description: document.getElementById('description').value.trim(),
          effect_type: document.getElementById('effect_type').value,
          target_faction: document.getElementById('target_faction').value,
          max_targets: parseInt(document.getElementById('max_targets').value || 1),
          score: parseInt(document.getElementById('score').value || 0),
          extra_cd: parseInt(document.getElementById('extra_cd').value || 0),
          effect_id_code: document.getElementById('effect_id_code').value.trim(),
          effect_code: document.getElementById('effect_code').value.trim()
        };
      } else if (type === 'move') {
        data = {
          move_name: document.getElementById('move_name').value.trim(),
          description: document.getElementById('move_description').value.trim(),
          target_faction: document.getElementById('move_target_faction').value,
          range: document.getElementById('move_range').value,
          max_targets: parseInt(document.getElementById('move_max_targets').value || 1),
          score: parseInt(document.getElementById('move_score').value || 0),
          extra_cd: parseInt(document.getElementById('move_extra_cd').value || 0),
          effect_id_code: document.getElementById('move_effect_id_code').value.trim(),
          effect_code: document.getElementById('move_effect_code').value.trim()
        };
      } else if (type === 'debuff') {
        data = {
          debuff_name: document.getElementById('debuff_name').value.trim(),
          description: document.getElementById('debuff_description').value.trim(),
          debuff_type: document.getElementById('debuff_type').value,
          offset_score: parseInt(document.getElementById('debuff_offset_score').value || 0),
          extra_cd: parseInt(document.getElementById('debuff_extra_cd').value || 0),
          applied_to: document.getElementById('debuff_applied_to').value,
          effect_id_code: document.getElementById('debuff_effect_id_code').value.trim(),
          effect_code: document.getElementById('debuff_effect_code').value.trim()
        };
      }

      // 驗證
      let msg = '';
      if (type === 'skill' && !data.effect_name) msg = '請填寫技能名稱';
      if (type === 'move' && !data.move_name) msg = '請填寫移動技能名稱';
      if (type === 'debuff' && !data.debuff_name) msg = '請填寫副作用名稱';
      if (msg) { showMsg(msg, true); return; }

      // 寫入 Supabase
      let table = (type === 'skill') ? 'skill_effects' : (type === 'move' ? 'movement_skills' : 'skill_debuff');
      let { error } = await client.from(table).insert([data]);
      if (error) {
        showMsg('寫入失敗：' + error.message, true);
      } else {
        showMsg('✅ 寫入成功！');
        clearForm(type);
      }
    }

    function showMsg(msg, isError) {
      document.getElementById('msg').innerHTML = '<span class=\"' + (isError ? 'error' : 'success') + '\">' + msg + '</span>';
    }
    function clearForm(type) {
      if (type === 'skill') {
        ['effect_name', 'description', 'effect_id_code', 'effect_code', 'score', 'extra_cd'].forEach(id => document.getElementById(id).value = '');
        document.getElementById('max_targets').value = '';
      }
      if (type === 'move') {
        ['move_name', 'move_description', 'move_effect_id_code', 'move_effect_code', 'move_score', 'move_extra_cd'].forEach(id => document.getElementById(id).value = '');
        document.getElementById('move_max_targets').value = '1';
      }
      if (type === 'debuff') {
        ['debuff_name', 'debuff_description', 'debuff_effect_id_code', 'debuff_effect_code', 'debuff_offset_score', 'debuff_extra_cd'].forEach(id => document.getElementById(id).value = '');
      }
    }
  </script>
</body>
</html>
